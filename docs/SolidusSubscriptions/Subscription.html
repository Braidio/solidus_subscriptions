<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: SolidusSubscriptions::Subscription
  
    &mdash; Documentation by YARD 0.9.7
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "SolidusSubscriptions::Subscription";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../SolidusSubscriptions.html" title="SolidusSubscriptions (module)">SolidusSubscriptions</a></span></span>
     &raquo; 
    <span class="title">Subscription</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: SolidusSubscriptions::Subscription
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">ActiveRecord::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next">SolidusSubscriptions::Subscription</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/solidus_subscriptions/subscription.rb</dd>
  </dl>
  
</div>


  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="PROCESSING_STATES-constant" class="">PROCESSING_STATES =
        
      </dt>
      <dd><pre class="code"><span class='lbracket'>[</span><span class='symbol'>:pending</span><span class='comma'>,</span> <span class='symbol'>:failed</span><span class='comma'>,</span> <span class='symbol'>:success</span><span class='rbracket'>]</span></pre></dd>
    
  </dl>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#processing_states-class_method" title="processing_states (class method)">.<strong>processing_states</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ransackable_scopes-class_method" title="ransackable_scopes (class method)">.<strong>ransackable_scopes</strong>(_auth_object = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#advance_actionable_date-instance_method" title="#advance_actionable_date (instance method)">#<strong>advance_actionable_date</strong>  &#x21d2; Date </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Advance the actionable date to the next_actionable_date value.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_be_canceled%3F-instance_method" title="#can_be_canceled? (instance method)">#<strong>can_be_canceled?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method determines if a subscription may be canceled.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_be_deactivated%3F-instance_method" title="#can_be_deactivated? (instance method)">#<strong>can_be_deactivated?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method determines if a subscription can be deactivated.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#line_item_builder-instance_method" title="#line_item_builder (instance method)">#<strong>line_item_builder</strong>  &#x21d2; SolidusSubscriptions::LineItemBuilder </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the builder for the subscription_line_item.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#next_actionable_date-instance_method" title="#next_actionable_date (instance method)">#<strong>next_actionable_date</strong>  &#x21d2; Date </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the date after the current actionable_date where this subscription will
be actionable again.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#processing_state-instance_method" title="#processing_state (instance method)">#<strong>processing_state</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The state of the last attempt to process an installment associated to this
subscrtipion.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#skip-instance_method" title="#skip (instance method)">#<strong>skip</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="processing_states-class_method">
  
    .<strong>processing_states</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/solidus_subscriptions/subscription.rb', line 67</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_processing_states'>processing_states</span>
  <span class='const'><span class='object_link'><a href="#PROCESSING_STATES-constant" title="SolidusSubscriptions::Subscription::PROCESSING_STATES (constant)">PROCESSING_STATES</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ransackable_scopes-class_method">
  
    .<strong>ransackable_scopes</strong>(_auth_object = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/solidus_subscriptions/subscription.rb', line 63</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ransackable_scopes'>ransackable_scopes</span><span class='lparen'>(</span><span class='id identifier rubyid__auth_object'>_auth_object</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='symbol'>:in_processing_state</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="advance_actionable_date-instance_method">
  
    #<strong>advance_actionable_date</strong>  &#x21d2; <tt>Date</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Advance the actionable date to the next_actionable_date value. Will modify
the record.</p>

<p>subscription will be eligible to be processed.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Date</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The next date after the current actionable_date this</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


166
167
168
169</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/solidus_subscriptions/subscription.rb', line 166</span>

<span class='kw'>def</span> <span class='id identifier rubyid_advance_actionable_date'>advance_actionable_date</span>
  <span class='id identifier rubyid_update!'>update!</span> <span class='label'>actionable_date:</span> <span class='id identifier rubyid_next_actionable_date'>next_actionable_date</span>
  <span class='id identifier rubyid_actionable_date'>actionable_date</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_be_canceled?-instance_method">
  
    #<strong>can_be_canceled?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method determines if a subscription may be canceled. Canceled
subcriptions will not be processed. By default subscriptions may always be
canceled. If this method is overriden to return false, the subscription
will be moved to the :pending_cancellation state until it is canceled again
and this condition is true.</p>

<p>USE CASE: Subscriptions can only be canceled more than 10 days before they
are processed. Override this method to be:</p>

<p>def can_be_canceled?</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_actionable_date'>actionable_date</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='lparen'>(</span><span class='id identifier rubyid_actionable_date'>actionable_date</span> <span class='op'>-</span> <span class='int'>10</span><span class='period'>.</span><span class='id identifier rubyid_days'>days</span><span class='period'>.</span><span class='id identifier rubyid_from_now'>from_now</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span><span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='int'>0</span>
</code></pre>

<p>end</p>

<p>If a user cancels this subscription less than 10 days before it will be
processed the subscription will be bumped into the :pending_cancellation
state instead of being canceled. Susbcriptions pending cancellation will
still be processed.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126
127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/solidus_subscriptions/subscription.rb', line 124</span>

<span class='kw'>def</span> <span class='id identifier rubyid_can_be_canceled?'>can_be_canceled?</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_actionable_date'>actionable_date</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_actionable_date'>actionable_date</span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="Config.html" title="SolidusSubscriptions::Config (module)">Config</a></span></span><span class='period'>.</span><span class='id identifier rubyid_minimum_cancellation_notice'>minimum_cancellation_notice</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_future?'>future?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_be_deactivated?-instance_method">
  
    #<strong>can_be_deactivated?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method determines if a subscription can be deactivated. A deactivated
subscription will not be processed. By default a subscription can be
deactivated if the end_date defined on subscription_line_item is less than
the current date In this case the subscription has been fulfilled and
should not be processed again. Subscriptions without an end_date value
cannot be deactivated.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


145
146
147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/solidus_subscriptions/subscription.rb', line 145</span>

<span class='kw'>def</span> <span class='id identifier rubyid_can_be_deactivated?'>can_be_deactivated?</span>
  <span class='id identifier rubyid_active?'>active?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_line_item'>line_item</span><span class='period'>.</span><span class='id identifier rubyid_end_date'>end_date</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_actionable_date'>actionable_date</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_line_item'>line_item</span><span class='period'>.</span><span class='id identifier rubyid_end_date'>end_date</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="line_item_builder-instance_method">
  
    #<strong>line_item_builder</strong>  &#x21d2; <tt><span class='object_link'><a href="LineItemBuilder.html" title="SolidusSubscriptions::LineItemBuilder (class)">SolidusSubscriptions::LineItemBuilder</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the builder for the subscription_line_item. This will be an object that
can generate the appropriate line item for the subscribable object</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="LineItemBuilder.html" title="SolidusSubscriptions::LineItemBuilder (class)">SolidusSubscriptions::LineItemBuilder</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


176
177
178</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/solidus_subscriptions/subscription.rb', line 176</span>

<span class='kw'>def</span> <span class='id identifier rubyid_line_item_builder'>line_item_builder</span>
  <span class='const'><span class='object_link'><a href="LineItemBuilder.html" title="SolidusSubscriptions::LineItemBuilder (class)">LineItemBuilder</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="LineItemBuilder.html#initialize-instance_method" title="SolidusSubscriptions::LineItemBuilder#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_line_items'>line_items</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="next_actionable_date-instance_method">
  
    #<strong>next_actionable_date</strong>  &#x21d2; <tt>Date</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the date after the current actionable_date where this subscription will
be actionable again</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Date</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The current actionable_date plus 1 interval. The next date after the
current actionable_date this subscription will be eligible to be processed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/solidus_subscriptions/subscription.rb', line 155</span>

<span class='kw'>def</span> <span class='id identifier rubyid_next_actionable_date'>next_actionable_date</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_active?'>active?</span>
  <span class='id identifier rubyid_new_date'>new_date</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_actionable_date'>actionable_date</span> <span class='op'>||</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_new_date'>new_date</span> <span class='op'>+</span> <span class='id identifier rubyid_interval'>interval</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_beginning_of_minute'>beginning_of_minute</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="processing_state-instance_method">
  
    #<strong>processing_state</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The state of the last attempt to process an installment associated to this
subscrtipion</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>pending if the no installments have been processed, failed if the last
installment has not been fulfilled and, success if the last installment was
fulfilled.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


186
187
188
189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/solidus_subscriptions/subscription.rb', line 186</span>

<span class='kw'>def</span> <span class='id identifier rubyid_processing_state'>processing_state</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_installments'>installments</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_installments'>installments</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_fulfilled?'>fulfilled?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>success</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>failed</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="skip-instance_method">
  
    #<strong>skip</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/solidus_subscriptions/subscription.rb', line 129</span>

<span class='kw'>def</span> <span class='id identifier rubyid_skip'>skip</span>
  <span class='id identifier rubyid_check_successive_skips_exceeded'>check_successive_skips_exceeded</span>
  <span class='id identifier rubyid_check_total_skips_exceeded'>check_total_skips_exceeded</span>

  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>

  <span class='id identifier rubyid_advance_actionable_date'>advance_actionable_date</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Jan 13 11:28:35 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.7 (ruby-2.3.0).
</div>

    </div>
  </body>
</html>